env:
  ES_ENDPOINT: https://localhost:9200
  ES_USERNAME: admin
  ES_PASSWORD: $[[keystore.ES_PASSWORD]]
  WEB_BINDING: 0.0.0.0:9000
  API_BINDING: 0.0.0.0:2900

coco:
  server:
    public: false
    name: "My Coco Server"
    encode_icon_to_base64: false # enable this if coco-server is using self-signed certs
#    #[START] for managed mode only, need to configured by coco-server operator
#    endpoint: "http://localhost:9001/"
#    auth_provider: #config for app to use
#      sso:
#        url: "http://localhost:9001/#/login"
#    #[END] for managed mode only
    minimal_client_version:
      number: "0.3"
    provider:
      name: "INFINI Labs"
      description: "Coco AI Server - Search, Connect, Collaborate, AI-powered enterprise search, all in one space."
      icon: "https://coco.rs/favicon.ico"
      website: "https://coco.rs/"
      eula: "https://coco.rs/#/terms"
      privacy_policy: "https://coco.rs/privacy"
      banner: "https://coco.rs/svg/connect.svg"
      #[START] for managed mode only, config for coco-server to use
      auth_provider:
        sso:
          url: "/sso/login/cloud?provider=coco-cloud&product=coco"
      #[END] for managed mode only
    store:
      endpoint: "https://coco.infini.cloud"
      local: false

## Cleanup exists data:
# curl -u admin:45ff432a5428ade77c7b -k -XDELETE   https://localhost:9200/_template/coco-search
# curl -u admin:45ff432a5428ade77c7b -k -XDELETE   https://localhost:9200/_template/coco
# curl -u admin:45ff432a5428ade77c7b -k -XDELETE  https://localhost:9200/_scripts/coco-query-string
# curl -u admin:45ff432a5428ade77c7b -k -XDELETE  https://localhost:9200/_scripts/coco-query-string-extra-should
# curl -u admin:45ff432a5428ade77c7b -k -XDELETE   https://localhost:9200/coco_*
elastic:
  elasticsearch: prod
  enabled: true
  store:
    enabled: false
  orm:
    enabled: true
    index_prefix: "coco_"
    override_exists_template: true
    override_exists_mapping: true
    index_templates:
      "coco-search": |
        {
          "order": 10,
          "index_patterns": [
            "coco_*"
          ],
          "settings": {
            "index": {
              "analysis": {
                "char_filter": {
                    "tsconvert" : {
                        "type" : "stconvert",
                        "delimiter" : ",",
                        "keep_both" : false,
                        "convert_type" : "t2s"
                    }
                 },
                "tokenizer": {
                      "my_pinyin": {
                        "type": "pinyin",
                        "keep_first_letter": true,
                        "keep_separate_first_letter": true,
                        "keep_full_pinyin": true,
                        "keep_original": false,
                        "limit_first_letter_length": 16,
                        "lowercase": true
                      }
                    },
                "analyzer": {
                  "pinyin_analyzer": {
                     "tokenizer": "my_pinyin"
                   },
                  "combined_text_analyzer": {
                    "char_filter": ["tsconvert"],
                    "filter": [
                      "lowercase",
                      "asciifolding",
                      "word_delimiter",
                      "unique"
                    ],
                    "tokenizer": "classic"
                  }
                }
              }
            }
          },
          "mappings": {}
        }

    search_templates:
      "coco-query-string": |
        {
            "from": "{{from}}",
            "size": "{{size}}",
            "_source": {
                "includes": [ "{{#source}}","{{.}}","{{/source}}"],
                "excludes": [ "payload.*","content" ]
            },
            "query": {
              "bool": {
                "must": {{#toJson}}must_clauses{{/toJson}},
                "must_not": [],
                "should": [
                  {{#query}}
                  {
                    "prefix": {
                      "{{field}}.keyword": {
                        "value": "{{query}}",
                        "boost": 100
                      }
                    }
                  },
                  {
                    "match_phrase_prefix": {
                      "{{field}}": {
                        "query": "{{query}}",
                        "boost": 50
                      }
                    }
                  },
                  {
                    "match_phrase": {
                      "{{field}}": {
                        "query": "{{query}}",
                        "boost": 30
                      }
                    }
                  },
                  {
                    "match": {
                      "{{field}}": {
                        "query": "{{query}}",
                        "fuzziness": "AUTO",
                        "max_expansions": 10,
                        "boost": 5,
                        "prefix_length": 2,
                        "operator": "and",
                        "fuzzy_transpositions": true
                      }
                    }
                  },
                  {
                    "query_string": {
                      "fields": ["{{field}}","{{field}}.keyword^10","combined_fulltext"],
                      "query": "{{query}}",
                      "fuzziness": "AUTO",
                      "fuzzy_prefix_length": 2,
                      "fuzzy_max_expansions": 10,
                      "boost": 3,
                      "default_operator": "AND",
                      "fuzzy_transpositions": true,
                      "allow_leading_wildcard": false
                    }
                  },{"match": {
                      "{{field}}.pinyin": {
                          "query": "{{query}}",
                          "boost": 4
                          }
                    }}
                  {{/query}}
                ]
              }
            }
        }
      "coco-query-string-extra-should": |
        {
            "from": "{{from}}",
            "size": "{{size}}",
            "_source": {
                "includes": [ "{{#source}}","{{.}}","{{/source}}"],
                "excludes": [ "payload.*","content" ]
            },
            "query": {
              "bool": {
                "must": {{#toJson}}must_clauses{{/toJson}},
                "must_not": [],
                "should": [
                  {{#query}}
                  {
                    "prefix": {
                      "{{field}}.keyword": {
                        "value": "{{query}}",
                        "boost": 100
                      }
                    }
                  },
                  {
                    "match_phrase_prefix": {
                      "{{field}}": {
                        "query": "{{query}}",
                        "boost": 50
                      }
                    }
                  },
                  {
                    "match_phrase": {
                      "{{field}}": {
                        "query": "{{query}}",
                        "boost": 30
                      }
                    }
                  },
                  {
                    "match": {
                      "{{field}}": {
                        "query": "{{query}}",
                        "fuzziness": "AUTO",
                        "max_expansions": 10,
                        "prefix_length": 2,
                        "boost": 5,
                        "fuzzy_transpositions": true
                      }
                    }
                  },
                  {
                    "query_string": {
                      "fields": ["{{field}}","{{field}}.keyword^10","combined_fulltext"],
                      "query": "{{query}}",
                      "fuzziness": "AUTO",
                      "fuzzy_prefix_length": 2,
                      "default_operator": "AND",
                      "boost": 3,
                      "fuzzy_max_expansions": 10,
                      "fuzzy_transpositions": true,
                      "allow_leading_wildcard": false
                    }
                  },{"match": {
                    "{{field}}.pinyin": {
                        "query": "{{query}}",
                        "boost": 4
                        }
                    }}
                  {{/query}}
                   ,{{#toJson}}extra_should_clauses{{/toJson}}
                ]
              }
            }
        }

elasticsearch:
  - name: prod
    enabled: true
    endpoints:
      - $[[env.ES_ENDPOINT]]
    discovery:
      enabled: false
    basic_auth:
      username: $[[env.ES_USERNAME]]
      password: $[[env.ES_PASSWORD]]

api:
  enabled: true
  websocket:
    enabled: false
  network:
    binding: $[[env.API_BINDING]]

web:
#  base_path: "/coco"
  enabled: true
  embedding_api: false
  network:
    binding: $[[env.WEB_BINDING]]
  tls:
    enabled: false
    skip_insecure_verify: true
    default_domain: "localhost:2900"
    #    default_domain: "api.coco.rs"
    auto_issue:
      enabled: false
      email: "hello@infinilabs.com"
      include_default_domain: true
      domains:
        - "www.coco.rs"
      provider:
        tencent_dns:
          secret_id: $[[keystore.TENCENT_DNS_ID]] #./bin/coco keystore add TENCENT_DNS_ID
          secret_key: $[[keystore.TENCENT_DNS_KEY]] #./bin/coco keystore add TENCENT_DNS_KEY
  security:
    enabled: true
    managed: false #remote managed instance
    authentication:
      native:
        enabled: true
      oauth:
        cloud:
          enabled: true
          client_secret: "999999"
          authorize_url: "http://localhost:9000/oauth/authorize"
          token_url: "http://localhost:9000/oauth/token"
          profile_url: "http://localhost:9000/account/profile"
          redirect_url: "http://localhost:9001/sso/callback/cloud"
          success_page: "/#/home"
          failed_page: "/#/login"
          scopes: [ "openid","email","profile"]

##background jobs
pipeline:
  - name: enrich_documents
    auto_start: false
    keep_running: true
    processor:
      - consumer:
          auto_commit_offset: true
          queue_selector:
            keys:
              - indexing_documents
          consumer:
            group: enriched_documents
            fetch_max_messages: 10
          processor:
            - file_type_detection: {}
            - file_extraction:
                tika_endpoint: "http://127.0.0.1:9998"
                timeout_in_seconds: 360
                chunk_size: 7000
                vision_model_provider: qianwen
                vision_model: qwen-vl-max
                pigo_facefinder_path: ""
            - document_summarization:
                model_provider: deepseek
                model: deepseek-chat
                model_context_length: 128000
                ai_insights_max_length: 500
            - extract_tags:
                model_provider: deepseek
                model: deepseek-chat
                model_context_length: 128000
            - document_embedding:
                model_provider: qianwen
                model: text-embedding-v4
                # Dimension of the vectors generated by your embedding model
                embedding_dimension: 1024
                # Chunk size in characters, it is recommended to use a value 
                # lower than you embedding model's input limit, e.g., if the
                # limit is 8192 tokens, then we can set chunk size to 7000.
                chunk_size: 7000
                output_queue:
                  name: "enriched_documents"

  - name: merge_documents
    auto_start: true
    keep_running: true
    processor:
      - indexing_merge:
          input_queue: "enriched_documents"
          idle_timeout_in_seconds: 1
          elasticsearch: "prod"
          index_name: "coco_document-v2"
          key_field: "id"
          output_queue:
            name: "merged_documents"
            label:
              tag: "merged"
          worker_size: 1
          bulk_size_in_kb: 10240
  - name: ingest_documents
    auto_start: true
    keep_running: true
    processor:
      - bulk_indexing:
          bulk:
            compress: true
            batch_size_in_mb: 10
            batch_size_in_docs: 10240
          consumer:
            fetch_max_messages: 100
          queues:
            type: indexing_merge
            tag: "merged"

  - name: connector_dispatcher
    auto_start: true
    keep_running: true
    singleton: true
    retry_delay_in_ms: 10000
    processor:
      - connector_dispatcher:
          max_running_timeout_in_seconds: 1200
#          pipelines_in_sync: true

http_client:
  default:
    proxy:
      enabled: false
      default_config:
        http_proxy: http://127.0.0.1:7890
        socket5_proxy: socks5://127.0.0.1:7890
      override_system_proxy_env: true #override system proxy's environment settings with this proxy settings
      permitted:
        - "google.com"
      denied:
        - "localhost"
        - "www.yuque.com"
        - "yuque.com"
        - "infinilabs.com"
        - "api.coco.rs"
        - "dashscope.aliyuncs.com"
      domains:
        "github.com":
          http_proxy: http://127.0.0.1:7890
          socket5_proxy: socks5://127.0.0.1:7890
recommend:
  default: '{ "recommendations": [ { "title": "Coco AI v0.9 Released: Automated AI Review & Plugin Architecture", "description": "Coco AI v0.9 introduces full support for automated AI review of GitLab merge requests and a plugin-based architecture for expanded data connectors.", "score": 0.99, "url": "https://blog.infinilabs.com/posts/2025/11-21-product-released-coco-ai-v0.9/", "category": "Product Release", "breadcrumbs": [ { "name": "Blog", "url": "/blog" }, { "name": "Product Release", "url": "/category/release" } ] }, { "title": "Coco AI v0.8 Released: Extensions, Linux Search & More", "description": "Coco AI v0.8 brings window management extensions, new connectors including Linux file search, and view extensions across platforms.", "score": 0.96, "url": "https://blog.infinilabs.com/posts/2025/09-29-product-released-coco-ai-v0.8/", "category": "Product Release", "breadcrumbs": [ { "name": "Blog", "url": "/blog" }, { "name": "Product Release", "url": "/category/release" } ] }, { "title": "Coco AI v0.6 Released: Introducing the Extension Store", "description": "Coco AI 0.6.0 adds an extension store to browse and install third-party extensions, expanding the platforms extensibility.", "score": 0.95, "url": "https://blog.infinilabs.com/posts/2025/06-29-product-released-coco-ai-v0.6/", "category": "Product Release", "breadcrumbs": [ { "name": "Blog", "url": "/blog" }, { "name": "Product Release", "url": "/category/release" } ] }, { "title": "Coco AI v0.5 Released: Local Plugins & Smarter Search", "description": "Coco AI v0.5 introduces local plugins, smarter application search, and instant AI commands, improving productivity and customization.", "score": 0.94, "url": "https://blog.infinilabs.com/posts/2025/06-11-product-released-coco-ai-v0.5/", "category": "Product Release", "breadcrumbs": [ { "name": "Blog", "url": "/blog" }, { "name": "Product Release", "url": "/category/release" } ] }, { "title": "Create Your Own AI Assistant: Coco AI v0.1.0 Released", "description": "Announcing the first preview release of Coco AI v0.1.0 a unified AI search and personal assistant tool that works across local and cloud data.", "score": 0.92, "url": "https://blog.infinilabs.com/posts/2025/02-14-product-released-coco-ai-v0.1/", "category": "Product Launch", "breadcrumbs": [ { "name": "Blog", "url": "/blog" }, { "name": "Product Launch", "url": "/category/news" } ] } ], "total": 5 }'
  hot_topics_for_homepage: '{ "recommendations": [ { "title": "Introducing Coco AI in Two Minutes  A Quick Start Video", "description": "A quick start video guide introducing Coco AI and showing how it works with Google Drive.", "score": 0.92, "url": "https://blog.infinilabs.com/posts/2024/a-quick-start-viideo-to-introduce-coco-ai-in-two-minutes/", "category": "Tutorial", "breadcrumbs": [ { "name": "Blog", "url": "/blog" }, { "name": "Tutorial", "url": "/category/tutorial" } ] }, { "title": "Coco AI v0.2 Released", "description": "Announcement of Coco AI v0.2, focusing on unified AI search, personal knowledge management, and enhanced productivity tools.", "score": 0.90, "url": "https://blog.infinilabs.com/posts/2025/03-16-product-released-coco-ai-v0.2/", "category": "Product Release", "breadcrumbs": [ { "name": "Blog", "url": "/blog" }, { "name": "Product Release", "url": "/category/release" } ] }, { "title": "Coco AI v0.3 Released", "description": "Announcement of Coco AI v0.3 with powerful widget integration for external platforms.", "score": 0.91, "url": "https://blog.infinilabs.com/posts/2025/04-06-product-released-coco-ai-v0.3/", "category": "Product Release", "breadcrumbs": [ { "name": "Blog", "url": "/blog" }, { "name": "Product Release", "url": "/category/release" } ] }, { "title": "Coco AI v0.4 Released", "description": "Details on Coco AI v0.4 with improved assistant settings and support for MCP.", "score": 0.93, "url": "https://blog.infinilabs.com/posts/2025/04-28-product-released-coco-ai-v0.4/", "category": "Product Release", "breadcrumbs": [ { "name": "Blog", "url": "/blog" }, { "name": "Product Release", "url": "/category/release" } ] }, { "title": "Coco AI v0.7 Released", "description": "Coco AI v0.7 introduces a brand new file search experience and fullscreen integrations.", "score": 0.94, "url": "https://blog.infinilabs.com/posts/2025/07-28-product-released-coco-ai-v0.7/", "category": "Product Release", "breadcrumbs": [ { "name": "Blog", "url": "/blog" }, { "name": "Product Release", "url": "/category/release" } ] } ], "total": 5 }'
  hot_topics_for_search_result: '{ "recommendations": [ { "title": "Welcome to the INFINI Labs Blog!", "description": "An introduction to the INFINI Labs blog, mission, and what readers can expect from future posts.", "score": 0.85, "url": "https://blog.infinilabs.com/posts/2024/welcome-to-our-blog/", "category": "Announcement", "breadcrumbs": [ { "name": "Blog", "url": "/blog" }, { "name": "Announcement", "url": "/category/announcement" } ] }, { "title": "Introducing Coco AI  Connect & Collaborate", "description": "Coco AI is a unified enterprise search platform that helps teams search and collaborate across multiple tools seamlessly. It brings AI-powered insights to enterprise knowledge workflows. ", "score": 0.88, "url": "https://blog.infinilabs.com/posts/2024/introducing-coco-ai/", "category": "Product Overview", "breadcrumbs": [ { "name": "Blog", "url": "/blog" }, { "name": "Product", "url": "/category/product" } ] }, { "title": "Your first Coco View extension  A small tic-tac-toe game", "description": "A tutorial showing how to build your first View extension for Coco AI, using a simple tic-tac-toe example to demonstrate extension capabilities.", "score": 0.89, "url": "https://blog.infinilabs.com/posts/2025/your-first-coco-view-extension-a-small-tic-tac-toe-game/", "category": "Tutorial", "breadcrumbs": [ { "name": "Blog", "url": "/blog" }, { "name": "Tutorial", "url": "/category/tutorial" } ] }, { "title": "Your first Coco Command extension  Spotify Control", "description": "Step-by-step tutorial on creating a Command extension for Coco AI that lets you control Spotify playback from within Coco.", "score": 0.87, "url": "https://blog.infinilabs.com/posts/2025/your-first-coco-command-extension-spotify-control/", "category": "Tutorial", "breadcrumbs": [ { "name": "Blog", "url": "/blog" }, { "name": "Tutorial", "url": "/category/tutorial" } ] }, { "title": "Protect Elasticsearch with INFINI Gateway: Block Unreasonable Queries", "description": "This article explores how to set up INFINI Gateway to safeguard Elasticsearch clusters by blocking unreasonable or malformed queries.", "score": 0.86, "url": "https://blog.infinilabs.com/posts/2025/protect-elasticsearch-with-infinigateway/", "category": "Guides", "breadcrumbs": [ { "name": "Blog", "url": "/blog" }, { "name": "Guides", "url": "/category/guides" } ] } ], "total": 5 }'

suggest:
  document_metadata: '{ "query": "", "recent_searches": [], "suggestions": [ { "suggestion": "Source", "icon": "database", "source": "The data source of the document.", "payload": { "field_name": "source.id", "field_data_type": "keyword", "support_multi_select": true } }, { "suggestion": "Category", "icon": "folder", "source": "Primary category of the document, e.g., report.", "payload": { "field_name": "category", "field_data_type": "keyword", "support_multi_select": true } }, { "suggestion": "Subcategory", "icon": "folder", "source": "Secondary category of the document, e.g., 2024.", "payload": { "field_name": "subcategory", "field_data_type": "keyword", "support_multi_select": true } }, { "suggestion": "Categories", "icon": "folder", "source": "List of categories the document belongs to.", "payload": { "field_name": "categories", "field_data_type": "keyword", "support_multi_select": true } }, { "suggestion": "Title", "icon": "heading-1", "source": "Title of the document.", "payload": { "field_name": "title", "field_data_type": "text", "support_multi_select": false } }, { "suggestion": "Summary", "icon": "book-open-text", "source": "A brief summary of the document content.", "payload": { "field_name": "summary", "field_data_type": "text", "support_multi_select": false } }, { "suggestion": "Type", "icon": "case-sensitive", "source": "Type of the document, e.g., PDF.", "payload": { "field_name": "type", "field_data_type": "keyword", "support_multi_select": false } }, { "suggestion": "Lang", "icon": "case-sensitive", "source": "Language of the document.", "payload": { "field_name": "lang", "field_data_type": "keyword", "support_multi_select": false } }, { "suggestion": "Content", "icon": "text", "source": "The main content or body of the document.", "payload": { "field_name": "content", "field_data_type": "text", "support_multi_select": false } }, { "suggestion": "Icon", "icon": "link", "source": "URL to the documents icon.", "payload": { "field_name": "icon", "field_data_type": "url", "support_multi_select": false } }, { "suggestion": "Thumbnail", "icon": "link", "source": "URL to the documents thumbnail image.", "payload": { "field_name": "thumbnail", "field_data_type": "url", "support_multi_select": false } }, { "suggestion": "Tags", "icon": "tag", "source": "Tags associated with the document.", "payload": { "field_name": "tags", "field_data_type": "keyword", "support_multi_select": true } }, { "suggestion": "URL", "icon": "link", "source": "URL link to the document.", "payload": { "field_name": "url", "field_data_type": "url", "support_multi_select": false } }, { "suggestion": "Size", "icon": "number", "source": "Size of the document in bytes.", "payload": { "field_name": "size", "field_data_type": "integer", "support_multi_select": false } }, { "suggestion": "Owner Avatar", "icon": "link", "source": "URL to the owners avatar image.", "payload": { "field_name": "owner.avatar", "field_data_type": "url", "support_multi_select": false } }, { "suggestion": "Owner Username", "icon": "case-sensitive", "source": "Username of the owner.", "payload": { "field_name": "owner.username", "field_data_type": "keyword", "support_multi_select": false } }, { "suggestion": "Owner Userid", "icon": "case-sensitive", "source": "User ID of the owner.", "payload": { "field_name": "owner.userid", "field_data_type": "keyword", "support_multi_select": false } }, { "suggestion": "Last Updated By User Avatar", "icon": "link", "source": "URL to the avatar of the last editor.", "payload": { "field_name": "last_updated_by.user.avatar", "field_data_type": "url", "support_multi_select": false } }, { "suggestion": "Last Updated By User Username", "icon": "case-sensitive", "source": "Username of the last editor.", "payload": { "field_name": "last_updated_by.user.username", "field_data_type": "keyword", "support_multi_select": false } }, { "suggestion": "Last Updated By User Userid", "icon": "case-sensitive", "source": "User ID of the last editor.", "payload": { "field_name": "last_updated_by.user.userid", "field_data_type": "keyword", "support_multi_select": false } }, { "suggestion": "Last Updated Timestamp", "icon": "calendar", "source": "Timestamp of the last update.", "payload": { "field_name": "last_updated_by.timestamp", "field_data_type": "datetime", "support_multi_select": false } } ] }'